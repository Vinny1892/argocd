apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: grafana
  namespace: argocd
spec:
  project: default
  source:
    repoURL: https://grafana.github.io/helm-charts
    targetRevision: "8.8.2"
    chart: grafana
    helm:
      values: |
         datasources:
            datasources.yaml:
              apiVersion: 1
              datasources:
                - name: Loki
                  type: Loki
                  url: http://monitoring.loki
                  isDefault: false
         ingress:
            enabled: true
              tls: []
              #  - secretName: chart-example-tls
              #    hosts:
              #      - chart-example.local
            ingressClassName: traefik
            hosts:
              - "grafana.k3s.home.vinny.dev.br"
          grafana.ini:
            server:
              domain: grafana.k3s.home.vinny.dev.br
  destination:
    server: https://kubernetes.default.svc
    namespace: traefik
  syncPolicy:
    syncOptions:
      - CreateNamespace=true
    automated:
      prune: true
      allowEmpty: true
      selfHeal: true